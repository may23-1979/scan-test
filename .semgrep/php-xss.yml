rules:
  - id: php-xss-output
    languages: [php]
    message: "ユーザ入力を HTML に未エスケープで出力しています (XSS)。"
    severity: ERROR
    mode: taint

    # ① 汚染源：スーパーグローバル
    pattern-sources:
      - pattern-either:
          - pattern: $_GET[..]
          - pattern: $_POST[..]
          - pattern: $_REQUEST[..]
          - pattern: $_COOKIE[..]

    # ② プロパゲータ：parse_str() で第2引数に渡った配列
    pattern-propagators:
      - pattern: |
          parse_str($QUERY, $ARR)

    # ③ シンク：echo / print / <?= … ?>
    pattern-sinks:
      - pattern: echo $X
      - pattern: print $X
      - pattern: "<?= $X ?>"

    # ④ サニタイザ：htmlspecialchars / htmlentities
    pattern-sanitizers:
      - pattern-either:
          - pattern: htmlspecialchars(...)
          - pattern: htmlentities(...)
